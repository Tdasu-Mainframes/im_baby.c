from tgs_dec_poc import *

'''
tsg_data = "$krb5tgs$18$EXAMPLE.NETlulu$95613ea2ea4ef8080d9b5957b09a71a1852454c71a1e52bcd246bc118ae2a539f7f919decba1fccad911c85772f4be450f68804e7efe64c72b78a0fbdad4b6fdce837c0d3acd56a723c702994dbf5a51a38237c263e6c0ca5d691de478a868e0372902d069358accf2f84b1f4f3ca2ffe15c40af4e654292aa52759261e87089ac0a9daaf13dd02c0cd751a8303befecf05add1196b55eea7e86cfa95e4c1f92e5640610c44013ce5e7587c9d3c697523b9f2d3a54ad0dda841e7d07a7691ad369657bc4cc12ec2f514a91ab67b5ec0d2f70a15241cc7d988bb8e515da283fbc493a028a31ace67ba610e43788a611d2281a008b217eb935ae7f36dd75fa43dd8d5f9dd657f1073365076b81ae59faf4189284b7bd883b64be34e163904815a43122d175a52647205f9a031d8722608106fecdb7f495ecaa580e6e40063bfd8e94b1240ffb19f55c710ecf4fef135477672c2e389ff6a29b08de45d14e66f321a7d77106c431882c4b5a444640454166d2d7631aa24f7afefb69180b2e51d32f536aebbea3481dcf0329c9618916a823d4aed8b909b573c9efe0847d5f772abe7790a5a57d9ac846da162a198190f60a27407bfbe8ea38988c9f4b258ed7374d1a7dd75aad51797a6d92e1045b85cba72294466a377a91e4271538bcbef67961691671be979b3cc4702743d3ce2839c03108fca779f6576e058eb3e67429817ae21574665a4aad1988e374d7142998502a7ea00db98d0bb102fe56ccd3741e0cddff5d0ce193facf6916995741ebbc77e4034b083d900dd5aa4ed7fc1713579ffb23563372703e8f2dedffca2d0553e1082379c7612809f4c5ec0729e5bc7fea7bb223c43249f98f0c59d1f3bc4d71460568ed4d6ebea7582bcd0a073bea283276917665a49468e9211e7a780c9809dc67d50ded82f23cef606f6110428ac43361dbd79afb608ed1407e5ca7014ccaa060461d180c73c25259fac23e4af825d868a6f5813da9fdbcf94f3d63b9726b92ff6d15d3f00389bd6d0b035d1b1ca868b96f842fa4850187c76a4e5828c7951ab9a2bb9bb4f0594e3233fa09b755e8e5da73133f3bd00d0a7562359395ab7f3aeb569dbf20a7cd458813754fbd5438049896aac9b75f7e361c64a232ac4b54d95b5d153f86c8e3b9250e5c218797e3bd73e83d3cec0030475d6ffc253e365eb0f2c1920e4b3c276b2291615aeb196ed45f0d89a0db02434a4e219c665f6fa92631576322e0770debc2fee762c76646a654c0e4f77afdc0d714f2412610abd936ecc80f9aff2ed4f736f4e9b4c0dd1750b50301be533475a0144b1aa78967fbded21b1021b56d3692212080356e6c668b8098b776dd24fa886a3cc70826254ecd39923d1bceeb4686aba928337fb15d1e76a033166d648f30843efd25e629612f9a5b0146b0f348c0bd9c$f72d514cff17d1a7f6213816"
pw = "openwall@123" #extracted from the network traffic between 2016 AD and 2016 client, TGS-REP traffic generated by https://github.com/nidem/kerberoast
'''

'''
tsg_data = "$krb5tgs$18$VM.NEThostkerb.vm.net$27388935062255f3b7b10106167633d7cc4735c8898c15ad16c8ff87c42e9f275ab5d86719d3381b6ab6e7d78968084eafd4d68b48e9f6bafa8a66735c68e34990fbe9661c2bfbdbab13dc488b590b6beb07fe38434825a29cf1f3c2d5db8b78b0be49daf5b81193017b94d59fa542b714bdb1060b375f8a3cf81cd4065729512e3d63b53bb784e87c6499264908753f62acebd5d58025860895640cd5a7d9beb5738380b8898f9530c8656b6383a7643d3b91301c15e3399b7e2f2300bef32b848edc8e430f203cff743d1f767353ed16ee4960b2eb9d66f747393d20b166c455a18235d323efa1a3346fc75614d46245cd8e8ac23f480c5435c853373e29$874ae55400d7c6ac7f0619b1"
pw = "kerb"
'''

tsg_data = "$krb5tgs$18$DUZA.NETftpduza.duza.net$72B585504B9335BB5D26AD5B2C1F8AE0BE5EDB8975B989AB0130449648737A83A116900323523516804D93B4B2207A7D3A4F1A841ACC5ED059744A9FD74778E95F1779861CB16A1E78420286B0476CCFF8BBAA0894DB5B1A6C3827D3EDAB90B9C0A75125C0723FC4BADBC8953E5AF837C4EE90B213138C15C7C77891AF2A684B4173833A759790DDC28D4BDF358EFD027450ADBA1C7E61F3C4CA12A293DFCD7ACF26C88D78A6BCE38217E8E733EF9AE26EADCFD50DC57EC416E8886863866E4B6A780F$FC47A5DF147A9369BD02DF61"
pw = "FTP"



#1d02be322524ea6b84cd34b00b7b100b6f1bc982bdb3029d7059b7f297780d48


t, tag, keytype, salt, enc_ticket, chksum = tsg_data.split('$')

enc_ticket = bytes.fromhex(enc_ticket + chksum)
salt = salt.encode()


if keytype == '18':
	seedsize = aes256_seedsize
elif keytype == '17':
	seedsize = aes128_seedsize

key_bytes = string_to_key_aes(pw.encode(), salt, seedsize, params=None)
print(key_bytes)
dec_ticket = decrypt(key_bytes, keyusage, enc_ticket, seedsize)

print('Decryption succsess! Here is the ticket:')
print(dec_ticket)
